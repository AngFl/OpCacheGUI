<?php
$status    = new OpCacheGUI\OpCache\Status($this->byteFormatter, $this->translator, opcache_get_status());

if (extension_loaded('Zend OPcache')) {
    $apcConfig = new OpCacheGUI\APCu\Configuration(ini_get_all('apcu', false));
    $apcStatus = new OpCacheGUI\APCu\Status(
        $this->byteFormatter,
        $apcConfig,
        $this->translator,
        apcu_cache_info(),
        apcu_sma_info()
    );
}

$memoryInfo = $status->getMemoryInfo();
$statsInfo  = $status->getStatsInfo();
?>

<section id="graphs" class="tabs">
    <ul>
        <li>
            <div class="chart-wrapper">
                <h2><?= $this->translator->translate('graph.memory.title'); ?></h2>
                <canvas id="memory" width="230" height="230"></canvas>
                <div id="memDataChartLegend"></div>
            </div>
        </li>
        <li>
            <div class="chart-wrapper">
                <h2><?= $this->translator->translate('graph.keys.title'); ?></h2>
                <canvas id="keys" width="230" height="230"></canvas>
                <div id="keysDataChartLegend"></div>
            </div>
        </li>
        <li>
            <div class="chart-wrapper">
                <h2><?= $this->translator->translate('graph.hits.title'); ?></h2>
                <canvas id="hits" width="230" height="230"></canvas>
                <div id="hitsDataChartLegend"></div>
            </div>
        </li>

        <?php if (extension_loaded('Zend OPcache')) { ?>
            <li>
                <div class="chart-wrapper">
                    <h2><?= $this->translator->translate('apcu.graph.memory.title'); ?></h2>
                    <canvas id="apcMemory" width="230" height="230"></canvas>
                    <div id="apcMemDataChartLegend"></div>
                </div>
            </li>
            <li>
                <div class="chart-wrapper">
                    <h2><?= $this->translator->translate('apcu.graph.fragmentation.title'); ?></h2>
                    <canvas id="keys" width="230" height="230"></canvas>
                    <div id="keysDataChartLegend"></div>
                </div>
            </li>
            <li>
                <div class="chart-wrapper">
                    <h2><?= $this->translator->translate('apcu.graph.hits.title'); ?></h2>
                    <canvas id="apcHits" width="230" height="230"></canvas>
                    <div id="apcHitsDataChartLegend"></div>
                </div>
            </li>
        <?php } ?>
    </ul>
</section>

<script>
    var memData  = <?= $status->getGraphMemoryInfo(); ?>;
    var keysData = <?= $status->getGraphKeyStatsInfo(); ?>;
    var hitsData = <?= $status->getGraphHitStatsInfo(); ?>;
</script>

<?php if (extension_loaded('Zend OPcache')) { ?>
    <script>
        var apcMemData  = <?= $apcStatus->getGraphMemoryInfo(); ?>;
        //var keysData = <?= $status->getGraphKeyStatsInfo(); ?>;
        var apcHitsData = <?= $status->getGraphHitStatsInfo(); ?>;
    </script>
<?php } ?>